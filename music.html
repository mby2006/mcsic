<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音乐播放器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #1e1e1e;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
        }

        .music-player {
            width: 350px;
            background: linear-gradient(to bottom, #2c2c2c, #1a1a1a);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            padding: 25px;
            text-align: center;
            box-sizing: border-box;
        }

        .album-cover {
            width: 100%;
            height: 0;
            padding-bottom: 100%; /* 1:1 Aspect Ratio */
            background-image: url('https://img.alicdn.com/imgextra/i3/O1CN01HKF8IE21NglxmBjwj_!!6000000006973-2-tps-456-502.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .song-info {
            margin: 15px 0;
        }

        .song-title {
            font-size: 1.5em;
            font-weight: bold;
            margin: 0;
            color: white;
        }

        .artist {
            font-size: 1em;
            color: #b3b3b3;
            margin: 5px 0 20px 0;
            font-weight: normal;
        }

        .progress-container {
            width: 100%;
            background-color: #535353;
            border-radius: 5px;
            height: 6px;
            margin: 10px 0;
            cursor: pointer;
            position: relative;
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background-color: #1db954;
            border-radius: 5px;
            transition: width 0.1s linear;
        }

        .time-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.8em;
            color: #b3b3b3;
            margin-top: 5px;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 25px 0;
        }

        .control-btn {
            background: none;
            border: none;
            color: #b3b3b3;
            font-size: 1.2em;
            cursor: pointer;
            transition: color 0.2s ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .control-btn:hover {
            color: #1db954;
        }

        .play-pause-btn {
            width: 50px;
            height: 50px;
            font-size: 1.5em;
        }
        
        /* 激活状态指示 */
        .control-btn.active {
            color: #1db954;
        }

        .lyrics-container {
            margin-top: 20px;
            height: 150px;
            overflow: hidden;
            text-align: center;
        }

        .lyrics {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .lyric-line {
            padding: 5px 0;
            font-size: 0.95em;
            color: #a7a7a7;
            transition: all 0.3s ease;
        }

        .lyric-line.active {
            color: white;
            font-size: 1.1em;
            font-weight: 500;
        }
    </style>
</head>
<body>

    <div class="music-player">
        <div class="album-cover"></div>
        
        <div class="song-info">
            <h2 class="song-title">Fade Before The Dawn</h2>
            <h3 class="artist">Joyful Supplyment</h3>
        </div>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="time-info">
            <span id="currentTime">0:00</span>
            <span id="totalTime">4:59</span>
        </div>

        <div class="controls">
            <button class="control-btn" id="shuffleBtn" title="随机播放">
                <i class="fas fa-random"></i>
            </button>
            <button class="control-btn" id="prevBtn" title="上一首">
                <i class="fas fa-step-backward"></i>
            </button>
            <button class="control-btn play-pause-btn" id="playPauseBtn" title="播放/暂停">
                <i class="fas fa-play"></i>
            </button>
            <button class="control-btn" id="nextBtn" title="下一首">
                <i class="fas fa-step-forward"></i>
            </button>
            <button class="control-btn" id="repeatBtn" title="重复">
                <i class="fas fa-redo"></i>
            </button>
        </div>

        <div class="lyrics-container">
            <ul class="lyrics" id="lyrics">
                <!-- 歌词时间已根据歌曲节奏调整 -->
                <li class="lyric-line" data-time="0">In the quiet of the night</li>
                <li class="lyric-line" data-time="5.5">Stars are fading from my sight</li>
                <li class="lyric-line" data-time="11">Fade before the dawn</li>
                <li class="lyric-line" data-time="16.5">Leaving shadows on the lawn</li>
                <li class="lyric-line" data-time="22">Whispers of a gentle breeze</li>
                <li class="lyric-line" data-time="27.5">Carry secrets through the trees</li>
                <li class="lyric-line" data-time="299"></li> <!-- 结束标记 -->
            </ul>
        </div>
    </div>

    <script>
        // --- 数据和状态 ---
        const totalDuration = 299; // 4分59秒
        let isPlaying = false;
        let startTime = 0;
        let pausedTime = 0;
        let animationId = null;
        let isShuffle = false;
        let isRepeat = false;

        // --- DOM 元素 ---
        const playPauseBtn = document.getElementById('playPauseBtn');
        const playIcon = playPauseBtn.querySelector('i');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const shuffleBtn = document.getElementById('shuffleBtn');
        const repeatBtn = document.getElementById('repeatBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const currentTimeDisplay = document.getElementById('currentTime');
        const lyricsLines = document.querySelectorAll('.lyric-line');
        let activeLyricIndex = -1;

        // --- 功能函数 ---

        // 格式化秒数为 mm:ss
        function formatTime(seconds) {
            const mins = Math.floor(seconds);
            const secs = Math.floor((seconds - mins) * 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // 更新进度条和时间显示
        function updateProgress(currentTimeSec) {
            const percentage = (currentTimeSec / totalDuration) * 100;
            progressBar.style.width = `${percentage}%`;
            currentTimeDisplay.textContent = formatTime(currentTimeSec);
        }

        // 更新高亮歌词
        function updateLyrics(currentTimeSec) {
            let newActiveIndex = -1;
            // 从当前高亮行或第一行开始查找，提高效率
            const startIndex = activeLyricIndex >= 0 ? activeLyricIndex : 0;
            
            for (let i = startIndex; i < lyricsLines.length; i++) {
                const time = parseFloat(lyricsLines[i].getAttribute('data-time'));
                const nextTime = i < lyricsLines.length - 1 ? 
                    parseFloat(lyricsLines[i+1].getAttribute('data-time')) : totalDuration;
                
                if (currentTimeSec >= time && currentTimeSec < nextTime) {
                    newActiveIndex = i;
                    break;
                }
                
                // 如果当前时间已经超过下一个时间点，继续检查下一行
                if (currentTimeSec >= nextTime && i < lyricsLines.length - 2) {
                    continue;
                }
                // 如果是最后一行且时间超过了它（或歌曲结束），则高亮最后一行（结束标记前）
                if (i === lyricsLines.length - 2 && currentTimeSec >= time) {
                     newActiveIndex = i;
                     break;
                }
            }
            
            // 处理初始状态或时间回到开头的情况
            if (newActiveIndex === -1 && currentTimeSec < parseFloat(lyricsLines[0].getAttribute('data-time'))) {
                newActiveIndex = 0;
            }


            if (newActiveIndex !== activeLyricIndex) {
                if (activeLyricIndex >= 0 && activeLyricIndex < lyricsLines.length) {
                    lyricsLines[activeLyricIndex].classList.remove('active');
                }
                if (newActiveIndex >= 0 && newActiveIndex < lyricsLines.length) {
                    lyricsLines[newActiveIndex].classList.add('active');
                }
                activeLyricIndex = newActiveIndex;
            }
        }

        // 重置播放器状态到开头
        function resetPlayerToStart() {
            if (isPlaying) {
                pauseAudio();
            }
            pausedTime = 0;
            updateProgress(0);
            updateLyrics(0);
            // 重置歌词高亮到第一行
            if (lyricsLines.length > 0 && activeLyricIndex !== 0) {
                if (activeLyricIndex >= 0 && activeLyricIndex < lyricsLines.length) {
                    lyricsLines[activeLyricIndex].classList.remove('active');
                }
                lyricsLines[0].classList.add('active');
                activeLyricIndex = 0;
            }
        }

        // 播放循环
        function playLoop() {
            if (!isPlaying) return;

            const elapsed = (Date.now() - startTime) / 1000;
            const currentTimeSec = pausedTime + elapsed;

            if (currentTimeSec >= totalDuration) {
                // 播放结束
                handleTrackEnd();
                return;
            }

            updateProgress(currentTimeSec);
            updateLyrics(currentTimeSec);
            animationId = requestAnimationFrame(playLoop);
        }

        // 处理单曲播放结束
        function handleTrackEnd() {
            pauseAudio(); // 先暂停
            updateProgress(totalDuration);
            updateLyrics(totalDuration); // 确保最后一行高亮或取消高亮

            if (isRepeat) {
                // 重复播放当前曲目
                resetPlayerToStart();
                playAudio();
            } else {
                // 停止在结尾
                 if (activeLyricIndex >= 0 && activeLyricIndex < lyricsLines.length) {
                    lyricsLines[activeLyricIndex].classList.remove('active');
                 }
                 // 最后一个有效歌词行是 lyricsLines.length - 2
                 if(lyricsLines.length > 1) {
                     lyricsLines[lyricsLines.length - 2].classList.add('active');
                     activeLyricIndex = lyricsLines.length - 2;
                 }
            }
        }

        // 播放
        function playAudio() {
            if (isPlaying) return;
            isPlaying = true;
            playIcon.classList.remove('fa-play');
            playIcon.classList.add('fa-pause');
            startTime = Date.now();
            playLoop();
        }

        // 暂停
        function pauseAudio() {
            if (!isPlaying) return;
            isPlaying = false;
            cancelAnimationFrame(animationId);
            const elapsed = (Date.now() - startTime) / 1000;
            pausedTime += elapsed;
            playIcon.classList.remove('fa-pause');
            playIcon.classList.add('fa-play');
        }

        // 切换播放/暂停
        function togglePlayPause() {
            if (isPlaying) {
                pauseAudio();
            } else {
                playAudio();
            }
        }

        // 上一首逻辑
        function prevTrack() {
            console.log("上一首按钮被点击");
            const elapsed = isPlaying ? (Date.now() - startTime) / 1000 : 0;
            const currentTimeSec = pausedTime + elapsed;
            
            // 如果当前播放时间超过3秒，则重置到开头
            if (currentTimeSec > 3) {
                resetPlayerToStart();
                if (isPlaying) {
                    playAudio(); // 继续播放
                }
            } else {
                // 否则，模拟切换到上一首（这里简化为重置）
                resetPlayerToStart();
                if (isPlaying) {
                    playAudio(); // 继续播放
                }
            }
        }

        // 下一首逻辑
        function nextTrack() {
            console.log("下一首按钮被点击");
            // 模拟切换到下一首（这里简化为重置）
            resetPlayerToStart();
            if (isPlaying) {
                playAudio(); // 继续播放
            }
        }

        // 切换随机播放模式
        function toggleShuffle() {
            isShuffle = !isShuffle;
            if (isShuffle) {
                shuffleBtn.classList.add('active');
            } else {
                shuffleBtn.classList.remove('active');
            }
            console.log("随机播放模式:", isShuffle ? "开启" : "关闭");
        }

        // 切换重复播放模式
        function toggleRepeat() {
            isRepeat = !isRepeat;
            if (isRepeat) {
                repeatBtn.classList.add('active');
            } else {
                repeatBtn.classList.remove('active');
            }
            console.log("重复播放模式:", isRepeat ? "开启" : "关闭");
        }

        // --- 事件监听 ---

        // 播放/暂停按钮
        playPauseBtn.addEventListener('click', togglePlayPause);

        // 上一首按钮
        prevBtn.addEventListener('click', prevTrack);

        // 下一首按钮
        nextBtn.addEventListener('click', nextTrack);

        // 随机播放按钮
        shuffleBtn.addEventListener('click', toggleShuffle);

        // 重复播放按钮
        repeatBtn.addEventListener('click', toggleRepeat);

        // 进度条点击
        progressContainer.addEventListener('click', (e) => {
            const rect = progressContainer.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const width = rect.width;
            const newTimeSec = (clickX / width) * totalDuration;

            // 更新状态
            if (isPlaying) {
                pauseAudio(); // 暂停当前播放
            }
            pausedTime = newTimeSec;
            updateProgress(pausedTime);
            updateLyrics(pausedTime);

            // 如果之前是播放状态，则继续播放
            if (playIcon.classList.contains('fa-pause')) {
                playAudio();
            }
        });

        // 初始化总时间显示
        document.getElementById('totalTime').textContent = formatTime(totalDuration);
        // 初始化第一行歌词高亮
        if (lyricsLines.length > 0) {
            lyricsLines[0].classList.add('active');
            activeLyricIndex = 0;
        }

    </script>
    
</body>
</html>



